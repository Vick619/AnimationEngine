<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" href="css/font-awesome-4.3.0/css/font-awesome.min.css">
        <script src="js/jquery-1.11.0.js" type="text/javascript"></script>
        <script>
//github test

        </script>
    </head>
    <body>
<!--        <div id = "backg" class="fa fa-tachometer fa-3x"> <br>Insert picture here</div>-->
        <div id="container">
	        <h1></h1>

            
            <div id  = "tutorial">
                <div class = "tutPage" id = "page1">page1</div>
                <div class = "tutPage" id = "page2">2</div>
                <div class = "tutPage" id = "page3">3</div>
                <div class = "tutPage" id = "page4">4</div>
                <div class = "tutPage" id = "page5">5</div>
            </div>
			<CANVAS id="stage" width="1080" height="720"></CANVAS>
            <CANVAS id="backgrounds" width="200" height="360"> </CANVAS>
            <CANVAS id="sprites" width="200" height="360"></CANVAS>
            <div class = "fa fa-caret-square-o-down fa-2x insetembossed" id = "backdropTut" >
            <br>Drag Backdrop Here!<br> <font size="3">(Rollover to activate)</font>
            </div>
            <div class = "fa fa-caret-square-o-down fa-2x insetembossed" id = "spriteTut" width="200" height="360">
            <br>Drag Sprites Here! <br> <font size="3"> (Rollover to activate)</font>
            </div>
            
            


            
            <div id="simplymator">
                <div id = "topBar">
                        <h1>Simplymator</h1>
                        <input class="fa fa-tachometer fa-3x insetembossed" type="range" min="0" max="200" value="0" id="speed"> 
                        <input class="fa fa-expand fa-3x insetembossed" type="range" min="0" max="300" value="50" id="size"> 
                        <input class="fa fa-circle-o fa-3x insetembossed" type="range" min="0" max="100" value="100" id="opacity"> 
                        <input class="fa fa-refresh fa-3x insetembossed" type="range" min="0" max="360" value="0" id="rotation"> 
                        <button class="fa fa-play fa-2x push_button" onclick="start()"></button>
                        <button class="fa fa-pause fa-2x push_button" onclick="stop()"></button>
                        <button class="fa fa-step-backward fa-2x push_button" onclick="restart()"></button>
                        <button class="fa fa-undo fa-2x push_button" onclick="reset()"></button>
                        <button class="fa fa-info-circle fa-2x push_button" onclick="removeInfo()"></button>
                </div>
            </div>
        </div>
    </body>
             
            
<script>
  
                //==============Setup GLOBAL varibles==============

                //var's for canvas resolution
                var width  = 1080;
                var height = 720;

                //Document setup for 2D animation and graphics
                var sp = document.getElementById("sprites");
                var spCtx = sp.getContext("2d")

                var bk = document.getElementById("backgrounds");
                var bkCtx = bk.getContext("2d")


                var c = document.getElementById("stage");
                var g = c.getContext("2d")
                	
                var	img = document.createElement("img");
                var	backgroundImg = document.createElement("img");

                //Var's setup for input html
                var speed = document.getElementById('speed').value;
                var size  = document.getElementById('size').value;
                var opc   = document.getElementById('opacity').value;
                var rot   = document.getElementById('rotation').value;

                //Var's for movement and object initialisation
                var clicks = 0; //amount of clicks in the canvas
                var moveX  = 0; //Mouse in the x-axis
                var moveY  = 0; //Mouse in the y-axis

                var startX = 0; //Starting position X (later defined by the first keyframe)
                var startY = 0; //Starting position Y (later defined by the first keyframe)
                var MX; //Mouse X container varible
                var MY; //Mouse Y container varible
                var keyframes = []; //array of keyframes

                var start2 = false; //Is there enough keyframes for the animation to beguin?
                var traveling = false; //Is the image on the move?

                var coor1 = 0;
                var coor2 = 0;
                var combCoor = 0;
    
                var imgRot = 0;
                var imgOpc = 0;
                var imgSiz = 0;
                var imgSd = 0;
                var play = false;
    
    
     $( "#page2" ).hide;
     $( "#page3" ).hide;
     $( "#page4" ).hide;
     $( "#page5" ).hide;

    
function p1b1(){
         $( "#page1" ).fadeOut( "slow", function() { });
         $( "#page2" ).fadeIn( "slow", function() { });
}
function p2b1(){
         $( "#page1" ).fadeIn( "slow", function() { });
         $( "#page2" ).fadeOut( "slow", function() { });}
function p2b2(){
         $( "#page2" ).fadeOut( "slow", function() { });
         $( "#page3" ).fadeIn( "slow", function() { });
}
    
function p3b1(){
         $( "#page3" ).fadeOut( "slow", function() { });
         $( "#page2" ).fadeIn( "slow", function() { });}
function p3b2(){
         $( "#page3" ).fadeOut( "slow", function() { });
         $( "#page4" ).fadeIn( "slow", function() { });        
}
    
function p4b1(){
         $( "#page4" ).fadeOut( "slow", function() { });
         $( "#page3" ).fadeIn( "slow", function() { });
}
function p4b2(){
         $( "#page4" ).fadeOut( "slow", function() { });
         $( "#page5" ).fadeIn( "slow", function() { });
}
    
function p5b1(){
         $( "#page5" ).fadeOut( "slow", function() { });
         $( "#page4" ).fadeIn( "slow", function() { });
}
function download(){console.log("Downloading...");}
    
var hidden = false;
function removeInfo(){
    console.log(hidden);
    if(hidden == false){
         $( "#page1" ).fadeOut( "slow", function() { });
         $( "#page2" ).fadeOut( "slow", function() { });
         $( "#page3" ).fadeOut( "slow", function() { });
         $( "#page4" ).fadeOut( "slow", function() { });
         $( "#page5" ).fadeOut( "slow", function() { });
        hidden = true;
    }
    else{
        $( "#page1" ).fadeIn( "slow", function() { });
        hidden = false;
    }
}
                
$( "#spriteTut" ).mouseenter(function() {
  $( "#spriteTut" ).fadeOut( "slow", function() {
   // $( "#spriteTut" ).hide;
  });
});
    $( "#backdropTut" ).mouseenter(function() {
  $( "#backdropTut" ).fadeOut( "slow", function() {
   // $( "#spriteTut" ).hide;
  });
});

    
                var KF = 1;
var spNumb = 0;
var sprites = [];


(function () {
        img.addEventListener("load", function () {
		  clearSpriteCanvas();
		  spCtx.drawImage(img, 100, 100);
        });
	// To enable drag and drop
	sp.addEventListener("dragover", function (evt) {
		evt.preventDefault();
	});
	// Handle dropped image file - only Firefox and Google Chrome
	sp.addEventListener("drop", function (evt) {
		var files = evt.dataTransfer.files;
		if (files.length > 0) {
			var file = files[0];
			if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {
				var reader = new FileReader();
				reader.onload = function (evt) {
                    //console.log(spNumb);
					
                    var sprite =  document.createElement("img");
                    sprite.src = evt.target.result;
                    
                    sprites[spNumb] = document.createElement("img");
                    sprites[spNumb].src = evt.target.result;
                    spNumb++;
                    
                    if (spNumb > 2){
                        spNumb = 0;
                    }
                    //console.log(sprites.length);
                    clearSpriteCanvas();
                    
                    for(i = 0; i < sprites.length; i++){
                        //console.log(sprites[i]);
                       spCtx.drawImage(sprites[i], 50, 0 + (i*110), 100, 100);
                    }
				};
				reader.readAsDataURL(file);
			}
		}
		evt.preventDefault();

	});
        clearSpriteCanvas = function () {
        spCtx.clearRect(0, 0, 200, 360);
    };
})();
    

var spY;
sp.addEventListener('mousemove', function() { // listens to the canvas for mouse moves
    var mouseY = event.clientY - 110; //find the Y movement
    spY = mouseY;
   //console.log(spY);
}); // end mouse move func
sp.addEventListener("click", function() {
    if (spY < 100){
        img =  sprites[0];
    }
    else if (spY > 200){
        img =  sprites[2];
    }
    else{
       img =  sprites[1];
    }
    
});



var bkNumb = 0;
var backgrounds = [];


(function () {
        img.addEventListener("load", function () {
          clearBackgroundCanvas();
          bkCtx.drawImage(img, 100, 100);
        });
    // To enable drag and drop
    bk.addEventListener("dragover", function (evt) {
        evt.preventDefault();
    });
    // Handle dropped image file - only Firefox and Google Chrome
    bk.addEventListener("drop", function (evt) {
        var files = evt.dataTransfer.files;
        if (files.length > 0) {
            var file = files[0];
            if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {
                var reader = new FileReader();
                reader.onload = function (evt) {

                   
                    //console.log(bkNumb);
                   // var sprite =  document.createElement("img");
                   // sprite.src = evt.target.result;
                    
                    backgrounds[bkNumb] = document.createElement("img");
                    backgrounds[bkNumb].src = evt.target.result;
                    
                   
                    //console.log(sprites.length);
                    clearBackgroundCanvas();
                    for(i = 0; i < backgrounds.length; i++){
                        //console.log(backgrounds[i]);

                       bkCtx.drawImage(backgrounds[i], 20, 0 + (i*110)+20, 150, 100);
                    }
                     bkNumb++;
                    if (bkNumb > 2){
                        bkNumb = 0;
                    }
                    
                };
                reader.readAsDataURL(file);
            }
        }
        evt.preventDefault();

    });
        clearBackgroundCanvas = function () {
        bkCtx.clearRect(0, 0, 200, 360);
    };
})();
    
var bkY;
bk.addEventListener('mousemove', function() { // listens to the canvas for mouse moves
    var mouseY = event.clientY - 110; //find the Y movement
    bkY = mouseY;
    //console.log(bkY);
}); // end mouse move func

bk.addEventListener("click", function() {
    if (bkY < 460){
        backgroundImg =  backgrounds[0];
        //console.log("top");
        
    }
    else if (bkY > 570){
        backgroundImg =  backgrounds[2];
        //console.log("bottom");
        
    }
    else{
       backgroundImg =  backgrounds[1];
       // console.log("mid");
       
    }
    
});


//==============Setup Function once the document is ready==============
$(document).ready(function() 
{
    img = new Image();
    backgroundImg = new Image();
img.src = "images/sprites/sprite1.png";
backgroundImg.src = "images/backdrops/bk1.png";

    //-----------Listen for clicks, run function whenever a click occurs on the page---------
   

  
    c.addEventListener("click", function() {
        startX = MX; //save the mouse X position form the click
        startY = MY; //Save the y pos too
        console.log(MY + " Y and X "+ MX);
        //If statement states that if the click is below 30px to prevent keyframes being added when clicking input boxes.
        if( (MY > 10) && (MX <  1060) ){
            
            clicks++; //Add to the number of clicks in the canvas
            var keyframe = {	// Add a single keyframe with 3 attributes
                numb: clicks,	// the click number
                Xpos: MX,		// X position of the KeyFrame
                Ypos: MY,		//	And Y position
                opacity: opc,
                rotation: rot,
                speed: speed,
                size: size,
            };
    



            keyframes.push(keyframe); //Adds the above 'keyframe' varible to the keyframeS array
            //ie, add a keyframe with attributes to the array
            for(i=0; i < keyframes.length; i++){
//            console.log("number: "+ keyframes[i].numb);
//            console.log("X: "+ keyframes[i].Xpos);
//            console.log("Y: "+ keyframes[i].Ypos);
//            console.log("Opacity: "+ keyframes[i].opacity);
//            console.log("Rot: "+ keyframes[i].rotation);
//            console.log("Speed: "+ keyframes[i].speed);
//            console.log("Size: "+ keyframes[i].size);
//            console.log("-------------------------");
            }

        }	
    
    }); //End the click listener func

    setInterval(update, 33); // Calls the Update() function 33 times a second
                             //Similar to processing's void Draw() funciton
});//End of setup func

//==============Listens for mouse movement and gets the mouse coordinates==============
c.addEventListener('mousemove', function() { // listens to the canvas for mouse moves
    var mouseX = event.clientX - 12; //find the X movement
    var mouseY = event.clientY - 110; //find the Y movement
    MX = mouseX; //link to global varibles
    MY = mouseY; // ^
}); // end mouse move func

//==============Update function (void Draw() 33x/sec)==============
function update(){

    clearBack(); // clears the canvas
    g.drawImage(backgroundImg, 0, 0, 1080, 720);
    //Keyframes array
     if(play == false){

        for(i = 0; i < keyframes.length; i++){
            
            if (i == 0){
                g.beginPath();
                g.fillStyle="#1ceb01";
                g.rect(	keyframes[i].Xpos - 2.5, keyframes[i].Ypos - 2.5,5 ,5);
                g.fill();
            }
            else if (i == keyframes.length - 1){
                g.beginPath();
                g.fillStyle="#eb4a0e";
                g.rect(	keyframes[i].Xpos - 2.5, keyframes[i].Ypos - 2.5,5 ,5);
                g.fill();
            }
            
            else{
                //var keyPoint = keyframes[i];
                g.beginPath();
                g.fillStyle="#383838";
                g.rect(	keyframes[i].Xpos - 2.5, keyframes[i].Ypos - 2.5,5 ,5);
                g.fill();
            }

         }
        }

    speed = document.getElementById('speed').value;
    size = document.getElementById('size').value;
    opc = document.getElementById('opacity').value;
    rot = document.getElementById('rotation').value;
    if(keyframes.length > 0){
        keyframes[keyframes.length-1].size = size;
        keyframes[keyframes.length-1].rotation = rot;
        keyframes[keyframes.length-1].opacity = opc;
    }
    if(start2 == true){

        
        
           // console.log(KF);
        var xdistance = keyframes[KF].Xpos - keyframes[KF-1].Xpos;
        var ydistance = keyframes[KF].Ypos - keyframes[KF-1].Ypos;
        var angle = Math.atan2(xdistance , ydistance);

        g.beginPath();
        g.fillStyle="#000000";
        g.fill();
       
        g.stroke();

        var imgRotDif = keyframes[KF].rotation - keyframes[KF-1].rotation;
        var factor = imgRotDif / diff(moveY,ydistance);
        //console.log(factor);
        
        
        
        g.save();
        g.translate(keyframes[KF-1].Xpos + moveX , keyframes[KF-1].Ypos + moveY);
        g.rotate(keyframes[KF-1].rotation *Math.PI/180);
        g.globalAlpha = keyframes[KF].opacity/100;
        g.drawImage(img, -keyframes[KF].size/2, -keyframes[KF].size/2, keyframes[KF].size, keyframes[KF].size);
        g.globalAlpha = 1;
        g.restore();

            if((diff(moveX,xdistance) > (speed/10)) || (diff(moveY,ydistance) > (speed/10))){
                moveX = moveX + Math.sin(angle)  * (speed/10);
                moveY = moveY + Math.cos(angle)  * (speed/10);
                
            }
            else{
                KF++;
                moveX = 0;
                moveY = 0;
                if (KF > keyframes.length - 1){
                    KF = 1;

                }
            }

    }
    else if(keyframes.length > 0){
        console.log("run");
        g.save();
        g.globalAlpha = keyframes[keyframes.length-1].opacity/100;
        g.translate(keyframes[keyframes.length-1].Xpos, keyframes[keyframes.length-1].Ypos);
        g.rotate(keyframes[keyframes.length-1].rotation *Math.PI/180);
        g.drawImage(img, 0 - (keyframes[keyframes.length-1].size/2), 0 - (keyframes[keyframes.length-1].size/2) ,  keyframes[keyframes.length-1].size , keyframes[keyframes.length-1].size);
      //  g.drawImage(img, keyframes[keyframes.length-1].Xpos - keyframes[keyframes.length-1].size/2, keyframes[keyframes.length-1].Ypos - keyframes[keyframes.length-1].size/2, keyframes[keyframes.length-1].size, keyframes[keyframes.length-1].size);
         g.globalAlpha = 1;
        
        g.restore();
    }

    //console.log(traveling);	

}

function diff(a,b)
{
    if(a>b) return a-b;
    else return b-a;
}

function clearBack(){
    g.beginPath()
    g.fillStyle = "#FFFFFF";
    g.fill();
    g.clearRect(0,0,width,height);
}


function start(){
    start2 = true;
    play = true;
}
function stop(){
    start2 = false;
    play = false;
}
function restart(){
    start2 = false;
    KF = 1;
    moveX = 0;
    moveY = 0;

}
function reset(){
    start2 = false;
   keyframes= [];
    KF = 1;
    moveX = 0;
    moveY = 0;
    play = false;

}
</script>
</html>