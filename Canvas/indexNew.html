<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <script src="js/jquery-1.11.0.js" type="text/javascript"></script>
        <script>
//github test

        </script>
    </head>
    <body>
        <div id="container">
	        <h1></h1>
            
			<CANVAS id="stage" width="1080" height="720"></CANVAS>
            <CANVAS id="backgrounds" width="200" height="360"></CANVAS>
            <CANVAS id="sprites" width="200" height="360"></CANVAS>
            
            
            


		
	        <div id = "topBar">
                Speed: <input type="text" id="speed"> 
                Size: <input type="text" id="size"> 
                Attribute3: <input type="text" id="at3"> 
                <button onclick="start()">START</button>
                <button onclick="stop()">SHTAP</button>
                <button onclick="restart()">RESTART</button>
                <button onclick="reset()">RESET</button>
            </div>
        </div>

            

	       
                
                
                
                
            
<script>
 

                
                
                
                
                //==============Setup GLOBAL varibles==============

                //var's for canvas resolution
                var width  = 1080;
                var height = 720;

                //Document setup for 2D animation and graphics
                var sp = document.getElementById("sprites");
                var spCtx = sp.getContext("2d")

                var bk = document.getElementById("backgrounds");
                var bkCtx = bk.getContext("2d")


                var c = document.getElementById("stage");
                var g = c.getContext("2d")
                	var	img = document.createElement("img");

                //Var's setup for input html
                var speed = document.getElementById('speed').value;
                var size  = document.getElementById('size').value;
                var rot   = document.getElementById('at3').value;

                //Var's for movement and object initialisation
                var clicks = 0; //amount of clicks in the canvas
                var moveX  = 0; //Mouse in the x-axis
                var moveY  = 0; //Mouse in the y-axis

                var startX = 0; //Starting position X (later defined by the first keyframe)
                var startY = 0; //Starting position Y (later defined by the first keyframe)
                var MX; //Mouse X container varible
                var MY; //Mouse Y container varible
                var keyframes = []; //array of keyframes

                var start2 = false; //Is there enough keyframes for the animation to beguin?
                var traveling = false; //Is the image on the move?

                var coor1 = 0;
                var coor2 = 0;
                var combCoor = 0;

                var KF = 1;
var spNumb = 0;
var sprites = [];

(function () {
        img.addEventListener("load", function () {
		  clearCanvas();
		  spCtx.drawImage(img, 100, 100);
        });
	// To enable drag and drop
	sp.addEventListener("dragover", function (evt) {
		evt.preventDefault();
	});
	// Handle dropped image file - only Firefox and Google Chrome
	sp.addEventListener("drop", function (evt) {
		var files = evt.dataTransfer.files;
		if (files.length > 0) {
			var file = files[0];
			if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {
				var reader = new FileReader();
				reader.onload = function (evt) {

                    spNumb++;
                    //console.log(spNumb);
					
                    var sprite =  document.createElement("img")
                    sprite.src = evt.target.result;
                    sprites.push(sprite);
                    //console.log(sprites.length);

                    for(i = 0; i < sprites.length; i++){
                        //console.log(sprites[i]);

                       spCtx.drawImage(sprites[i], 50, 0 + (i*110), 100, 100);
                    }
				};
				reader.readAsDataURL(file);
			}
		}
		evt.preventDefault();

	});
        clearCanvas = function () {
        spCtx.clearRect(0, 0, canvas.width, canvas.height);
    };
})();



var bkNumb = 0;
var backgrounds = [];
(function () {
        img.addEventListener("load", function () {
          clearCanvas();
          bkCtx.drawImage(img, 100, 100);
        });
    // To enable drag and drop
    bk.addEventListener("dragover", function (evt) {
        evt.preventDefault();
    });
    // Handle dropped image file - only Firefox and Google Chrome
    bk.addEventListener("drop", function (evt) {
        var files = evt.dataTransfer.files;
        if (files.length > 0) {
            var file = files[0];
            if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {
                var reader = new FileReader();
                reader.onload = function (evt) {

                    bkNumb++;
                    //console.log(bkNumb);
                    
                    var background =  document.createElement("img")
                    background.src = evt.target.result;
                    backgrounds.push(background);
                    console.log(backgrounds.length);

                    for(i = 0; i < backgrounds.length; i++){
                        console.log(backgrounds[i]);

                       bkCtx.drawImage(backgrounds[i], 10, 0 + (i*110), 150, 100);
                    }
                };
                reader.readAsDataURL(file);
            }
        }
        evt.preventDefault();

    });
        clearCanvas = function () {
        bkCtx.clearRect(0, 0, canvas.width, canvas.height);
    };
})();
    
    
                //==============Setup Function once the document is ready==============
                $(document).ready(function() 
                {
                    img = new Image();
                img.src = "images/frog.png";

                    //-----------Listen for clicks, run function whenever a click occurs on the page---------
                    addEventListener("click", function() {
                        startX = MX; //save the mouse X position form the click
                        startY = MY; //Save the y pos too

                        //If statement states that if the click is below 30px to prevent keyframes being added when clicking input boxes.
                        if( (MY > 100)  ){

                            clicks++; //Add to the number of clicks in the canvas
                            var keyframe = {	// Add a single keyframe with 3 attributes
                                numb: clicks,	// the click number
                                Xpos: MX,		// X position of the KeyFrame
                                Ypos: MY,		//	And Y position
                                rotation: rot,
                                speed: speed,
                                size: size,
                            };



                            keyframes.push(keyframe); //Adds the above 'keyframe' varible to the keyframeS array
                            //ie, add a keyframe with attributes to the array

                        }	
                    }); //End the click listener func

                    setInterval(update, 33); // Calls the Update() function 33 times a second
                                             //Similar to processing's void Draw() funciton
                });//End of setup func

                //==============Listens for mouse movement and gets the mouse coordinates==============
                c.addEventListener('mousemove', function() { // listens to the canvas for mouse moves
                    var mouseX = event.clientX - 12; //find the X movement
                    var mouseY = event.clientY - 110; //find the Y movement
                    MX = mouseX; //link to global varibles
                    MY = mouseY; // ^
                }); // end mouse move func

                //==============Update function (void Draw() 33x/sec)==============
                function update(){

                    clearBack(); // clears the canvas
                    //Keyframes array
                    for(i = 0; i < keyframes.length; i++){
                        var keyPoint = keyframes[i];
                        g.beginPath();
                        g.fillStyle="#000000";
                        g.rect(	keyPoint.Xpos - 2.5, keyPoint.Ypos - 2.5,5 ,5);
                        g.fill();
                    }

                    speed = document.getElementById('speed').value;
                    size = document.getElementById('size').value;
                    rot = document.getElementById('at3').value;

                    if(start2 == true){


                            console.log(KF);
                        var xdistance = keyframes[KF].Xpos - keyframes[KF-1].Xpos;
                        var ydistance = keyframes[KF].Ypos - keyframes[KF-1].Ypos;
                        var angle = Math.atan2(xdistance , ydistance);

                        g.beginPath();
                        g.fillStyle="#000000";
                        g.fill();
                        //g.rect(	(keyframes[KF-1].Xpos   - (size/2)) + moveX ,	(keyframes[KF-1].Ypos  - (size/2))+ moveY	,size ,size);
                        g.stroke();

                        //g.scale(size/10, size/10);
                      
                      //  g.save();
                        
                      //  g.translate(    ( keyframes[KF-1].Xpos + moveX - (size/2))/2 ,  (keyframes[KF-1].Ypos + moveY - (size/2))/2 );
                     //   g.rotate(0.2);
                        g.drawImage(img, keyframes[KF-1].Xpos + moveX - (size/2), keyframes[KF-1].Ypos + moveY - (size/2), size, size);
                        
                     //   g.restore();

                            if((diff(moveX,xdistance) > (speed/10)) || (diff(moveY,ydistance) > (speed/10))){
                                moveX = moveX + Math.sin(angle)  * (speed/10);
                                moveY = moveY + Math.cos(angle)  * (speed/10);
                            }
                            else{
                                KF++;
                                moveX = 0;
                                moveY = 0;
                                if (KF > keyframes.length - 1){
                                    KF = 1;

                                }
                            }

                    }

                    //console.log(traveling);	
                }

                function diff(a,b)
                {
                    if(a>b) return a-b;
                    else return b-a;
                }

                function clearBack(){
                    g.beginPath()
                    g.fillStyle = "#FFFFFF";
                    g.fill();
                    g.clearRect(0,0,width,height);
                }

                function up(){


                }
                function start(){
                    start2 = true;
                }
                function stop(){
                    start2 = false;

                }
                function restart(){
                    start2 = false;
                    KF = 1;
                    moveX = 0;
                    moveY = 0;

                }
                function reset(){
                    start2 = false;
                   keyframes= [];
                    KF = 1;
                    moveX = 0;
                    moveY = 0;

                }
	        </script>
        </div>
    </body>
</html>